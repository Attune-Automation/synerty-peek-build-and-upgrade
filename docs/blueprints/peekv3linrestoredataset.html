
<!doctype html>
<html lang="en">




<head>
    <title>How to Peek v3 LIN Restore Dataset - Attune Automation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title"
          content="How to Peek v3 LIN Restore Dataset - Attune Automation">
    <meta name="description"
          content="">
    <meta name="robots"
          content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">

    <meta property="og:locale" content="en_AU" />
    <meta property="og:type" content="article" />
    <meta property="og:title"
          content="HowTo Peek v3 LIN Restore Dataset - Attune Automation" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="Attune Automation" />
    <meta property="article:section" content="IT Instruction" />

    <meta name="twitter:title"
          content="How to Peek v3 LIN Restore Dataset - Attune Automation" />
    <meta name="twitter:description" content="" />

    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-180x180.png">
    <meta name="msapplication-TileImage" content="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-270x270.png">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="../styles/style.css">

</head>


<body>

<!-- Project breadcrumbs -->

<!-- Project breadcrumbs -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0">
        <li class="breadcrumb-item" aria-current="page">
            <a
                href="https://www.servertribe.com/"
                target="_blank">
                ServerTribe
            </a>
        </li>
        <li class="breadcrumb-item" aria-current="page">
            <a
                href="https://github.com/attune-Automation/"
                target="_blank">
                Attune Automation Projects
            </a>
        </li>
        <li class="breadcrumb-item">
            <a href="../index.html">
            Build nznp1pek1 RHEL8 + oVirt
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <strong>Peek v3 LIN Restore Dataset</strong>
        </li>
    </ol>
</nav>

<!-- Blueprint Header -->

<div class="container px-0">
    <!-- Blueprint name and description -->
    <div class="row pt-5">
        <div class="col px-0">
            <h1 class="text-left">
                How to Peek v3 LIN Restore Dataset
            </h1>
        </div>
    </div>

<!-- Blueprint Description -->
    <div class="row pt-4">
        <div class="col-6 px-0">
            <h6 class="text-left">
                This documentation is generated by
                <a href="https://www.servertribe.com/"
                    class="badge badge-primary"
                    target="_blank">
                    Attune
                </a>
            </h6>
        </div>
        <div class="col-6 align-self-end text-right px-0">
            <h6 class="text-right">
                <a href="https://www.youtube.com/@servertribe"
                    class="badge badge-secondary"
                    target="_blank">
                    YouTube
                </a>
                <a href="https://github.com/Attune-Automation"
                    class="badge badge-secondary"
                    target="_blank">
                    GitHub
                </a>
                <a href="https://discord.com/invite/3YpJsagqUn"
                    class="badge badge-secondary"
                    target="_blank">
                    Discord
                </a>
                <a href="https://www.linkedin.com/company/servertribe/"
                    class="badge badge-secondary"
                    target="_blank">
                    LinkedIn
                </a>
                <a href="http://doc.servertribe.com/"
                    class="badge badge-secondary"
                    target="_blank">
                    Documentation
                </a>
            </h6>
        </div>
    </div>
    <hr>
</div>

<div class="documentation">
    <div class="container px-0">
        <div class="row">

<!-- Blueprint ToC -->


            <div class="col-lg-2 px-0 pr-5">
                <div class="container px-0 pt-3 sticky-top">
                    <h6 class="pb-2">
                        <strong>Contents</strong>
                    </h6>
                    <h6 class="text-muted">
                        <a href="#top">
                            <strong>Peek v3 LIN Restore Dataset</strong>
                        </a>
                    </h6>


    
        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrcleanrestoredir">
                            <strong>Step 1 -</strong> Peek v3 LIN PDR Clean Restore Dir
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrdeploydataset">
                            <strong>Step 2 -</strong> Peek v3 LIN PDR Deploy Dataset
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrextractdataset">
                            <strong>Step 3 -</strong> Peek v3 LIN PDR Extract Dataset
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrrenamedataset">
                            <strong>Step 4 -</strong> Peek v3 LIN PDR Rename Dataset
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrstoppeek">
                            <strong>Step 5 -</strong> Peek v3 LIN PDR Stop Peek
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrreloadpeekdb">
                            <strong>Step 6 -</strong> Peek v3 LIN PDR Reload Peek DB
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrdropplpython3ulanguage">
                            <strong>Step 7 -</strong> Peek v3 LIN PDR Drop plpython3u Language
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrrestorepeekconfigfiles">
                            <strong>Step 8 -</strong> Peek v3 LIN PDR Restore Peek Config Files
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linconfigurejsonconfig">
                            <strong>Step 9 -</strong> Peek v3 LIN Configure JSON Config
                        </a>
                    </h6>
    
        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccdeployskeletonconfig">
                            <strong>Step 9.1 -</strong> Peek v3 LIN PCC Deploy Skeleton Config
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccconfigureenabledplugins">
                            <strong>Step 9.2 -</strong> Peek v3 LIN PCC Configure Enabled Plugins
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccremovepeekplugindocdb">
                            <strong>Step 9.3 -</strong> Peek v3 LIN PCC Remove peek_plugin_docdb
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccconfiguresqlalchemyurl">
                            <strong>Step 9.4 -</strong> Peek v3 LIN PCC Configure SQLAlchemy URL
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccconfigurerecoveryadminuser">
                            <strong>Step 9.5 -</strong> Peek v3 LIN PCC Configure Recovery Admin User
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccupdatefilesystempaths">
                            <strong>Step 9.6 -</strong> Peek v3 LIN PCC Update File System Paths
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccupdatefieldofficeappkeys">
                            <strong>Step 9.7 -</strong> Peek v3 LIN PCC Update Field Office App Keys
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccupdatehomepaths">
                            <strong>Step 9.8 -</strong> Peek v3 LIN PCC Update Home Paths
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccupdatepofpluginnames">
                            <strong>Step 9.9 -</strong> Peek v3 LIN PCC Update PoF Plugin Names
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpcccleanupoldsettings">
                            <strong>Step 9.10 -</strong> Peek v3 LIN PCC Cleanup Old Settings
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccenableproductionfrontends">
                            <strong>Step 9.11 -</strong> Peek v3 LIN PCC Enable Production Frontends
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccenableproductionlogging">
                            <strong>Step 9.12 -</strong> Peek v3 LIN PCC Enable Production Logging
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpccenableproductionworker">
                            <strong>Step 9.13 -</strong> Peek v3 LIN PCC Enable Production Worker
                        </a>
                    </h6>


        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrunlockwebappbuild">
                            <strong>Step 10 -</strong> Peek v3 LIN PDR Unlock WebApp Build
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrdroppeekstorageservicefixbuginpeek">
                            <strong>Step 11 -</strong> Peek v3 LIN PDR Drop Peek Storage Service (FIX BUG IN PEEK)
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrupgradetimescaledb">
                            <strong>Step 12 -</strong> Peek v3 LIN PDR Upgrade TimescaleDB
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrmigratedatabase">
                            <strong>Step 13 -</strong> Peek v3 LIN PDR Migrate Database
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrupdateappservers">
                            <strong>Step 14 -</strong> Peek v3 LIN PDR Update App Servers
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrupdategistilespath">
                            <strong>Step 15 -</strong> Peek v3 LIN PDR Update GIS Tiles Path
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3purgerabbitmq">
                            <strong>Step 16 -</strong> Peek v3 Purge RabbitMQ
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdredeleteoldlogs">
                            <strong>Step 17 -</strong> Peek v3 LIN PDRE Delete Old Logs
                        </a>
                    </h6>

        

                    <h6 class="text-muted pt-2">
                        <a href="#peekv3linpdrcleanrestoredir">
                            <strong>Step 18 -</strong> Peek v3 LIN PDR Clean Restore Dir
                        </a>
                    </h6>


                </div>
            </div>

<!-- Blueprint Contents -->
            <div class="col-lg-8 pt-3">
                <div class="container">


        <div class="blueprint-description jumbotron">
            <h2 class="display-3 text-center">
                Automate This
            </h2>
            <p class="lead text-center">
                Use the <strong>Attune GUI</strong> for your Scripts
            </p>
            <p class="lead">
                <ol>
                    <a href="https://www.servertribe.com/download-attune-registration/"
                        target="_blank">
                        <span class="badge badge-primary">1</span>
                        Download Attune
                        <i class="fa-solid fa-download fa-beat-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://github.com/attune-Automation/"
                        target="_blank">
                        <span class="badge badge-primary">2</span>
                         Copy the Attune Project URL
                         <i class="fa-brands fa-github fa-fade"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://servertribe-attune.readthedocs.io/en/latest/howto/design_workspace/clone_project.html"
                        target="_blank">
                        <span class="badge badge-primary">3</span>
                        Clone the Project in Attune
                         <i class="fa-solid fa-book fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=GCWDI29rDV0"
                        target="_blank">
                        <span class="badge badge-primary">4</span>
                        Plan your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
                <ol>
                    <a href="https://www.youtube.com/watch?v=b7DhFcURkZg"
                        target="_blank">
                        <span class="badge badge-primary">5</span>
                        Run your Job(s)
                        <i class="fa-brands fa-youtube fa-fade" style="color: #0197ff;"></i>
                    </a>
                </ol>
            </p>
            <p class="lead text-center">
                You've automated: <strong>Peek v3 LIN Restore Dataset</strong>
            </p>
            <hr class="my-4 text-center">
            <div class="col px-0">
                <p class="text-center">
                    Get the most out of automation with our get started
                    videos, product demonstrations, and more.
                </p>
                <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://www.servertribe.com/learn/"
                       target="_blank"
                       role="button">
                        Learn Attune Automation
                    </a>
                </p>
            </div>
        </div>

        <div class="row">
            <p>The following steps will guide you through the manual process.</p>
        </div>

<!-- Blueprint Steps -->


        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrcleanrestoredir">
                            <a href="#peekv3linpdrcleanrestoredir">
                                <strong>Step 1 -</strong> Peek v3 LIN PDR Clean Restore Dir
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {linuxpeekuser}@{peekserver}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd /backup

if [ -d restore ]; then
    echo &quot;Cleaning restore directory&quot;
    rm -rf restore
else
    echo &quot;No cleaning required&quot;
fi
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrdeploydataset">
                            <a href="#peekv3linpdrdeploydataset">
                                <strong>Step 2 -</strong> Peek v3 LIN PDR Deploy Dataset
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    

    



    <div class="row">
        <p>
            
        </p>
        <p>
            Copy the File(s)
            <strong>Peek_Datacut_bnnnp1pek3.zip</strong>
            to the target node.
        </p>
        <p>
            <strong>Extract and deploy the File(s)</strong> here:
        </p>
    </div>
    <div class="row py-1">
        <code class="language-bash">
/backup/restore
        </code>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrextractdataset">
                            <a href="#peekv3linpdrextractdataset">
                                <strong>Step 3 -</strong> Peek v3 LIN PDR Extract Dataset
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd /backup/restore

# if [ &quot;`ls *latest.7z | wc -l`&quot; -ne &quot;1&quot; ]; then
#     echo &quot;We expect only one file ending in *latest.7z&quot;
#     ls *latest.7z
#     false
# fi

7z x -bt -mmt8 `ls -r *.7z | head -1`

# 7z a \
#     -bt \
#     -mmt8 \
#     -p{peekDbEncryptionKey.password} \
#     $ARCHIVE_7Z $NEW_DIR_NAME
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrrenamedataset">
                            <a href="#peekv3linpdrrenamedataset">
                                <strong>Step 4 -</strong> Peek v3 LIN PDR Rename Dataset
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd /backup/restore

rm -v *.7z

# If this is a ad-hoc backup, check to see if we need to move files
if [ -d peek-logic-service.home ]
then
    echo &quot;We don&#x27;t need need to move anything&quot;
else
    mv -v */* .
fi

! [ -d peek-server.home ] || mv -v peek-server.home peek-logic-service.home
! [ -d peek-worker.home ] || mv -v peek-worker.home peek-worker-service.home
! [ -d peek-agent.home ] || mv -v peek-agent.home peek-agent-service.home
! [ -d peek-storage.home ] || mv -v peek-storage.home peek-storage-service.home
! [ -d peek-client.home ] || cp -prv peek-client.home peek-office-service.home
! [ -d peek-client.home ] || mv -v peek-client.home peek-field-service.home
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrstoppeek">
                            <a href="#peekv3linpdrstoppeek">
                                <strong>Step 5 -</strong> Peek v3 LIN PDR Stop Peek
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
for s in peek_agent peek_worker peek_field peek_office peek_logic
do
        echo &quot;Stopping $s&quot;
        sudo systemctl stop ${s}.service || true
done

echo &quot;Waiting for services to stop&quot;
sleep 5s

echo &quot;Killing anything left running&quot;
pkill -9 -u $USER -f python || true
                </code>
            </pre>
        </div>
    </div>

    <div class="row">
        <p>
            This script may require you to answer the following prompts:
        </p>
    </div>
    <div class="row">
        <table>
            <thead>
                <tr>
                    <th>
                        Prompt
                    </th>
                    <th class="prompts">
                        Answer
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        password for peek:
                    </td>
                    <td class="prompts">
                        <code class="language-sql">
{linuxPeekUser.password}
                        </code>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>




        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrreloadpeekdb">
                            <a href="#peekv3linpdrreloadpeekdb">
                                <strong>Step 6 -</strong> Peek v3 LIN PDR Reload Peek DB
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
DB_FILE=`ls /backup/restore/peek.sql`

if ! [ -f ${DB_FILE} ]
then
    echo &quot;The database file doesn&#x27;t exist&quot;
    false
fi

dropdb peek
createdb -O peek peek

cat ${DB_FILE} | psql
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrdropplpython3ulanguage">
                            <a href="#peekv3linpdrdropplpython3ulanguage">
                                <strong>Step 7 -</strong> Peek v3 LIN PDR Drop plpython3u Language
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
psql &lt;&lt; EOF
DROP language IF EXISTS plpython3u CASCADE;
EOF
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrrestorepeekconfigfiles">
                            <a href="#peekv3linpdrrestorepeekconfigfiles">
                                <strong>Step 8 -</strong> Peek v3 LIN PDR Restore Peek Config Files
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
# Remove logs
rm -rvf peek*.log*

# Remove existing homges
rm -rf peek-*.home

# Move backup homes into place
mv -v /backup/restore/peek*.home . || true

# Clean temp dirs
rm -rf peek-*.home/tmp
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="peekv3linconfigurejsonconfig">
                            <a href="#peekv3linconfigurejsonconfig">
                                <strong>Step 9 -</strong> Peek v3 LIN Configure JSON Config
                            </a>
                        </h3>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>





    




    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccdeployskeletonconfig">
                            <a href="#peekv3linpccdeployskeletonconfig">
                                <strong>Step 9.1 -</strong> Peek v3 LIN PCC Deploy Skeleton Config
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    

    



    <div class="row">
        <p>
            
        </p>
        <p>
            Copy the File(s)
            <strong>Peek_v3_Skeleton_Config_JSON_DMS_Diagram.tar</strong>
            to the target node.
        </p>
        <p>
            <strong>Extract and deploy the File(s)</strong> here:
        </p>
    </div>
    <div class="row py-1">
        <code class="language-bash">
/home/peek
        </code>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccconfigureenabledplugins">
                            <a href="#peekv3linpccconfigureenabledplugins">
                                <strong>Step 9.2 -</strong> Peek v3 LIN PCC Configure Enabled Plugins
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

SKELETON_FILE = &quot;%s/skeleton_config.json&quot; % homeDir

with open(SKELETON_FILE) as f:
    skeletonJson = json.loads(f.read())

services = [&quot;logic&quot;, &quot;agent&quot;, &quot;worker&quot;, &quot;office&quot;, &quot;field&quot;]

for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)
    print(&quot;Configuring &quot; + cfgFile)

    if exists(cfgFile):
        print(&quot;Updating plugins&quot;)
        with open(cfgFile) as f:
            data = json.loads(f.read())
            
            # Set default
            data[&quot;plugin&quot;] = data.get(&quot;plugin&quot;, {})
            
            # Update the plugins
            data[&quot;plugin&quot;][&quot;enabled&quot;] = skeletonJson[&quot;plugin&quot;][&quot;enabled&quot;]
            
    else:
        print(&quot;Setting plugins&quot;)
        data = skeletonJson
    
    if not exists(dirname(cfgFile)):
        makedirs(dirname(cfgFile))
    
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
        
print(&quot;Removing skeleton file &quot; + SKELETON_FILE)
remove(SKELETON_FILE)
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccremovepeekplugindocdb">
                            <a href="#peekv3linpccremovepeekplugindocdb">
                                <strong>Step 9.3 -</strong> Peek v3 LIN PCC Remove peek_plugin_docdb
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
sed -i &#x27;/peek_plugin_docdb/d&#x27; peek*.home/config.json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccconfiguresqlalchemyurl">
                            <a href="#peekv3linpccconfiguresqlalchemyurl">
                                <strong>Step 9.4 -</strong> Peek v3 LIN PCC Configure SQLAlchemy URL
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

services = [&quot;logic&quot;, &quot;worker&quot;, &quot;storage&quot;]

URL = &quot;postgresql://{postgresqlServiceUser.user}:{postgresqlServiceUser.password}@127.0.0.1/peek&quot;

for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)
    print(&quot;Configuring &quot; + cfgFile)

    if exists(cfgFile):
        print(&quot;Updating plugins&quot;)
        with open(cfgFile) as f:
            data = json.loads(f.read())
            
            # Set default
            data[&quot;sqlalchemy&quot;] = data.get(&quot;sqlalchemy&quot;, {})
            
            # Update the plugins
            data[&quot;sqlalchemy&quot;][&quot;connectUrl&quot;] = URL
            
    else:
        print(&quot;Setting plugins&quot;)
        data = {
            &quot;sqlalchemy&quot;: {
                &quot;connectUrl&quot;: URL,
            }
        }
    
    if not exists(dirname(cfgFile)):
        makedirs(dirname(cfgFile))
        
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccconfigurerecoveryadminuser">
                            <a href="#peekv3linpccconfigurerecoveryadminuser">
                                <strong>Step 9.5 -</strong> Peek v3 LIN PCC Configure Recovery Admin User
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

cfgFile = &quot;%s/peek-logic-service.home/config.json&quot; % expanduser(&quot;~&quot;)
print(&quot;Configuring &quot; + cfgFile)

if exists(cfgFile):
    print(&quot;Updating plugins&quot;)
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
else:
    if not exists(dirname(cfgFile)):
        makedirs(dirname(cfgFile))
        
    print(&quot;Setting plugins&quot;)
    data = {}
        
# Update the login
data[&quot;httpServer&quot;] = data.get(&quot;httpServer&quot;, {})
data[&quot;httpServer&quot;][&quot;admin&quot;] = data[&quot;httpServer&quot;].get(&quot;admin&quot;, {})
data[&quot;httpServer&quot;][&quot;admin&quot;][&quot;recovery_user&quot;] = {
    &quot;password&quot;: &quot;{peekRecoveryAdminUser.password}&quot;,
    &quot;username&quot;: &quot;{peekRecoveryAdminUser.user}&quot;
}
    
print(&quot;Writing config&quot;)
with open(cfgFile, &quot;w&quot;) as f:
    f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccupdatefilesystempaths">
                            <a href="#peekv3linpccupdatefilesystempaths">
                                <strong>Step 9.6 -</strong> Peek v3 LIN PCC Update File System Paths
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

services = [&quot;logic&quot;, &quot;agent&quot;, &quot;worker&quot;, &quot;office&quot;, &quot;field&quot;]


def fixPath(path, service):
    # Strip of the c:
    if &quot;:&quot; in path:
        path = path.split(&quot;:&quot;, 1)[1]

    # Ensure the separators are RHEL format
    path = path.replace(&quot;\\&quot;, &quot;/&quot;)
    
    # Rehome the path.
    serviceDirName = &quot;peek-%s-service.home&quot; % service
    
    if serviceDirName not in path:
        return path
        
    path = path[path.index(serviceDirName) + len(serviceDirName):].strip(&#x27;/&#x27;)
    
    return &quot;%s/peek-%s-service.home/%s&quot; % (homeDir, service, path)


for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)

    if not exists(cfgFile):
        print(&quot;Skipping non-existent &quot; + cfgFile)
        continue
    
    print(&quot;Configuring &quot; + cfgFile)
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
        if &quot;disk&quot; in data and &quot;tmp&quot; in data[&quot;disk&quot;]:
            data[&quot;disk&quot;][&quot;tmp&quot;] = fixPath(data[&quot;disk&quot;][&quot;tmp&quot;], service)

        if &quot;frontend&quot; in data:
            frontend = data[&quot;frontend&quot;]
            keys = [&quot;frontendCustomisations&quot;,
                    &quot;frontendNodeModuleOverlayDir&quot;,
                    &quot;frontendSrcOverlayDir&quot;]
                    
            for key in keys:
                if key in frontend:
                    frontend[key] = fixPath(frontend[key], service)
                
            data[&quot;frontend&quot;] = frontend
        
        if &quot;plugin&quot; in data and &quot;dataPath&quot; in data[&quot;plugin&quot;]:
            data[&quot;plugin&quot;][&quot;dataPath&quot;] = fixPath(data[&quot;plugin&quot;][&quot;dataPath&quot;], service)

            
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccupdatefieldofficeappkeys">
                            <a href="#peekv3linpccupdatefieldofficeappkeys">
                                <strong>Step 9.7 -</strong> Peek v3 LIN PCC Update Field Office App Keys
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove


cfgFile = expanduser(&quot;~/peek-field-service.home/config.json&quot;)

if exists(cfgFile):
    print(&quot;Configuring &quot; + cfgFile)
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
        if &quot;frontend&quot; in data and &quot;nativescriptBuildPrepareEnabled&quot; in data[&quot;frontend&quot;]:
            del data[&quot;frontend&quot;][&quot;nativescriptBuildPrepareEnabled&quot;]
        
        if &quot;httpServer&quot; in data and &quot;office&quot; in data[&quot;httpServer&quot;]:
            del data[&quot;httpServer&quot;][&quot;office&quot;]
        
        if &quot;server&quot; in data:
            if &quot;webSocketPort&quot; in data[&quot;server&quot;]:
                del data[&quot;server&quot;][&quot;webSocketPort&quot;]
            
            if &quot;docSitePort&quot; in data[&quot;server&quot;]:
                del data[&quot;server&quot;][&quot;docSitePort&quot;]
    
            if &quot;desktopSitePort&quot; in data[&quot;server&quot;]:
                del data[&quot;server&quot;][&quot;desktopSitePort&quot;]
    
            if &quot;mobileSitePort&quot; in data[&quot;server&quot;]:
                data[&quot;server&quot;][&quot;fieldSitePort&quot;] = data[&quot;server&quot;][&quot;mobileSitePort&quot;]
                del data[&quot;server&quot;][&quot;mobileSitePort&quot;]

            
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))



cfgFile = expanduser(&quot;~/peek-office-service.home/config.json&quot;)

if exists(cfgFile):
    print(&quot;Configuring &quot; + cfgFile)
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
        if &quot;frontend&quot; in data and &quot;nativescriptBuildPrepareEnabled&quot; in data[&quot;frontend&quot;]:
            del data[&quot;frontend&quot;][&quot;nativescriptBuildPrepareEnabled&quot;]
        
        if &quot;httpServer&quot; in data and &quot;field&quot; in data[&quot;httpServer&quot;]:
            del data[&quot;httpServer&quot;][&quot;field&quot;]
        
        if &quot;server&quot; in data:
            if &quot;webSocketPort&quot; in data[&quot;server&quot;]:
                del data[&quot;server&quot;][&quot;webSocketPort&quot;]
            
            if &quot;docSitePort&quot; in data[&quot;server&quot;]:
                del data[&quot;server&quot;][&quot;docSitePort&quot;]
    
            if &quot;desktopSitePort&quot; in data[&quot;server&quot;]:
                data[&quot;server&quot;][&quot;officeSitePort&quot;] = data[&quot;server&quot;][&quot;desktopSitePort&quot;]
                del data[&quot;server&quot;][&quot;desktopSitePort&quot;]
    
            if &quot;mobileSitePort&quot; in data[&quot;server&quot;]:
                del data[&quot;server&quot;][&quot;mobileSitePort&quot;]

            
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccupdatehomepaths">
                            <a href="#peekv3linpccupdatehomepaths">
                                <strong>Step 9.8 -</strong> Peek v3 LIN PCC Update Home Paths
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
F=&quot;peek-logic-service.home/config.json&quot;
[ -f ${F} ] &amp;&amp; sed -i &#x27;s|peek-server.home|peek-logic-service.home|g&#x27; ${F}

F=&quot;peek-worker-service.home/config.json&quot;
[ -f ${F} ] &amp;&amp; sed -i &#x27;s|peek-worker.home|peek-worker-service.home|g&#x27; ${F}

F=&quot;peek-agent-service.home/config.json&quot;
[ -f ${F} ] &amp;&amp; sed -i &#x27;s|peek-agent.home|peek-agent-service.home|g&#x27; ${F}

F=&quot;peek-office-service.home/config.json&quot;
[ -f ${F} ] &amp;&amp; sed -i &#x27;s|peek-client.home|peek-office-service.home|g&#x27; ${F}

F=&quot;peek-field-service.home/config.json&quot;
[ -f ${F} ] &amp;&amp; sed -i &#x27;s|peek-client.home|peek-field-service.home|g&#x27; ${F}
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccupdatepofpluginnames">
                            <a href="#peekv3linpccupdatepofpluginnames">
                                <strong>Step 9.9 -</strong> Peek v3 LIN PCC Update PoF Plugin Names
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
sed -i &#x27;s/peek_plugin_pof/peek_plugin_enmac/g&#x27; peek*.home/config.json
sed -i &#x27;s/peek_plugin_pon/peek_plugin_enmac/g&#x27; peek*.home/config.json
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpcccleanupoldsettings">
                            <a href="#peekv3linpcccleanupoldsettings">
                                <strong>Step 9.10 -</strong> Peek v3 LIN PCC Cleanup Old Settings
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

services = [&quot;logic&quot;, &quot;agent&quot;, &quot;worker&quot;, &quot;office&quot;, &quot;field&quot;]

for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)
    print(&quot;Configuring &quot; + cfgFile)

    if not exists(cfgFile):
        continue
    
    print(&quot;Cleaning plugins&quot;)
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
        # Set default
        plugin = data.get(&quot;plugin&quot;)
        
        for key in list(plugin):
            if key.startswith(&quot;peek_plugin&quot;) or key.startswith(&quot;peek_core&quot;):
                del plugin[key]
                
        data[&quot;plugin&quot;] = plugin
        
        if service == &quot;logic&quot;:
            if &quot;platform&quot; in data:
                del data[&quot;platform&quot;]
                
            if &quot;server&quot; in data:
                del data[&quot;server&quot;]
            
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccenableproductionfrontends">
                            <a href="#peekv3linpccenableproductionfrontends">
                                <strong>Step 9.11 -</strong> Peek v3 LIN PCC Enable Production Frontends
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

services = [&quot;logic&quot;, &quot;office&quot;, &quot;field&quot;]

for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)
    print(&quot;Configuring &quot; + cfgFile)

    if not exists(cfgFile):
        continue
    
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
        # Set default
        print(&quot;Setting Production Flags for Frontend&quot;)
        frontend = data.get(&quot;frontend&quot;, {})
        frontend[&quot;docBuildEnabled&quot;] = True
        frontend[&quot;docBuildPrepareEnabled&quot;] = True
        frontend[&quot;docSyncFilesForDebugEnabled&quot;] = False
        
        frontend[&quot;webBuildPrepareEnabled&quot;] = True
        frontend[&quot;webBuildEnabled&quot;] = True
        frontend[&quot;syncFilesForDebugEnabled&quot;] = False

            
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccenableproductionlogging">
                            <a href="#peekv3linpccenableproductionlogging">
                                <strong>Step 9.12 -</strong> Peek v3 LIN PCC Enable Production Logging
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

services = [&quot;logic&quot;, &quot;office&quot;, &quot;field&quot;, &quot;agent&quot;, &quot;worker&quot;]

for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)
    print(&quot;Configuring &quot; + cfgFile)

    if not exists(cfgFile):
        continue
    
    with open(cfgFile) as f:
        data = json.loads(f.read())

        # Set default
        print(&quot;Setting Production Flags for Logging&quot;)
        frontend = data.get(&quot;logging&quot;, {})
        frontend[&quot;rotateSizeMb&quot;] = 20
        frontend[&quot;rotationsToKeep&quot;] = 10
        frontend[&quot;level&quot;] = &quot;INFO&quot;
        frontend[&quot;debugMemoryMask&quot;] = 0
        frontend[&quot;logToStdout&quot;] = False
        
        frontend[&quot;syslog&quot;] = frontend.get(&quot;syslog&quot;, {})
        frontend[&quot;syslog&quot;][&quot;logToSysloyHost&quot;] = None

    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>





    



                    <div class="row pt-5">
                        <h4 id="peekv3linpccenableproductionworker">
                            <a href="#peekv3linpccenableproductionworker">
                                <strong>Step 9.13 -</strong> Peek v3 LIN PCC Enable Production Worker
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
import json
from os.path import expanduser, exists, dirname
from os import makedirs, remove

homeDir = expanduser(&quot;~&quot;)

services = [&quot;logic&quot;]

for service in services:
    cfgFile = &quot;%s/peek-%s-service.home/config.json&quot; % (homeDir, service)
    print(&quot;Configuring &quot; + cfgFile)

    if not exists(cfgFile):
        continue
    
    with open(cfgFile) as f:
        data = json.loads(f.read())
        
        # Set default
        print(&quot;Enabling Celery Worker&quot;)
        data[&quot;celery&quot;] = data.get(&quot;celery&quot;, {})
        data[&quot;celery&quot;][&quot;plpython&quot;] = data[&quot;celery&quot;].get(&quot;plpython&quot;, {})
        data[&quot;celery&quot;][&quot;plpython&quot;][&quot;enable&quot;] = False

            
    print(&quot;Writing config&quot;)
    with open(cfgFile, &quot;w&quot;) as f:
        f.write(json.dumps(data, indent=4))
                </code>
            </pre>
        </div>
    </div>






        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrunlockwebappbuild">
                            <a href="#peekv3linpdrunlockwebappbuild">
                                <strong>Step 10 -</strong> Peek v3 LIN PDR Unlock WebApp Build
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
# Remove ngcc lock file to allow WebApp Build
cd /home/peek/synerty-peek*/lib/python*/site-packages/peek_admin_app

rm -v node_modules/@angular/compiler-cli/ngcc/__ngcc_lock_file__ \
    || echo &quot;Can&#x27;t remove lock file, it may have been arleady removed&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrdroppeekstorageservicefixbuginpeek">
                            <a href="#peekv3linpdrdroppeekstorageservicefixbuginpeek">
                                <strong>Step 11 -</strong> Peek v3 LIN PDR Drop Peek Storage Service (FIX BUG IN PEEK)
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            <p>This is a workaround, Fix peek instead.</p>
<p>Dropping this storage service means Peek won't have to migrate the schema, it will just recreate it.</p>
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
psql &lt;&lt;&lt; &quot;DROP SCHEMA peek_storage_service CASCADE;&quot;
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrupgradetimescaledb">
                            <a href="#peekv3linpdrupgradetimescaledb">
                                <strong>Step 12 -</strong> Peek v3 LIN PDR Upgrade TimescaleDB
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
psql -X &lt;&lt;EOF
DROP EXTENSION timescaledb CASCADE;
EOF

psql -X &lt;&lt;EOF
CREATE EXTENSION timescaledb ;
EOF
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrmigratedatabase">
                            <a href="#peekv3linpdrmigratedatabase">
                                <strong>Step 13 -</strong> Peek v3 LIN PDR Migrate Database
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
LOG=&quot;peek-logic-service.log&quot;

echo &quot;Cleaning old logs&quot;
[ ! -f $LOG ] || rm $LOG
touch $LOG

# Starting migration
sudo systemctl restart peek_logic

echo &quot;Waiting for Peek Logic Service to finish starting.&quot;
while ! grep &quot;Peek Logic is running&quot; $LOG
do
    echo &quot;Checking ...&quot;
    sleep 5
done

# Check for Errors
if grep -q &quot;ERROR&quot; $LOG
then
    cat $LOG
    echo &quot;The Peek Logic Service started with errors&quot; &gt;&amp;2
    false
fi

echo &quot;SUCCESS The Peek Logic Service started without errors&quot;

echo &quot;Stopping Peek Logic Service again&quot;
sudo systemctl stop peek_logic
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrupdateappservers">
                            <a href="#peekv3linpdrupdateappservers">
                                <strong>Step 14 -</strong> Peek v3 LIN PDR Update App Servers
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
psql &lt;&lt;&quot;EOF&quot;


-- PoF Diagram Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_diagram_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_diagram_loader.&quot;AppServerSettingsTuple&quot;
			(&quot;appHost&quot;, &quot;appSshUsername&quot;, &quot;appSshPassword&quot;,
			    &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;,
			    &quot;enabled&quot;, &quot;environmentName&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false, &#x27;replace_me&#x27;
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_diagram_loader.&quot;AppServerSettingsTuple&quot;);

		UPDATE pl_enmac_diagram_loader.&quot;AppServerSettingsTuple&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appSshUsername&quot; = &#x27;{linuxAdmsUser.user}&#x27;,
			&quot;appSshPassword&quot; = &#x27;{linuxAdmsUser.password}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;,
			&quot;environmentName&quot; = &#x27;{peekEnmacEnvironmentName}&#x27;;
    END IF;
END
$$;


-- PoF Equipment Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_equipment_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_equipment_loader.&quot;AppServerSettings&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_equipment_loader.&quot;AppServerSettings&quot;);

		UPDATE pl_enmac_equipment_loader.&quot;AppServerSettings&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;


-- PoN Event Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_event_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_event_loader.&quot;AppServerSettings&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_event_loader.&quot;AppServerSettings&quot;);

		UPDATE pl_enmac_event_loader.&quot;AppServerSettings&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;



-- PoF Switching Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_switching_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_switching_loader.&quot;AppServerSettings&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_switching_loader.&quot;AppServerSettings&quot;);

		UPDATE pl_enmac_switching_loader.&quot;AppServerSettings&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;



-- PoF GIS Location Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_gis_location_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_gis_location_loader.&quot;AppServerSettingsTuple&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_gis_location_loader.&quot;AppServerSettingsTuple&quot;);

		UPDATE pl_enmac_gis_location_loader.&quot;AppServerSettingsTuple&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;

-- PoF User Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_user_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_user_loader.&quot;AppServerSettingsTuple&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_user_loader.&quot;AppServerSettingsTuple&quot;);

		UPDATE pl_enmac_user_loader.&quot;AppServerSettingsTuple&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;



-- PoF LiveDB Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_livedb_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_livedb_loader.&quot;AppServerSettingsTuple&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_livedb_loader.&quot;AppServerSettingsTuple&quot;);

		UPDATE pl_enmac_livedb_loader.&quot;AppServerSettingsTuple&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;



-- PoF GraphDB Loader
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_graphdb_loader&#x27;
     )
    THEN
		INSERT INTO pl_enmac_graphdb_loader.&quot;AppServerSettings&quot;
			(&quot;appHost&quot;, &quot;appOracleUsername&quot;, &quot;appOraclePassword&quot;, &quot;enabled&quot;)
		SELECT &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, &#x27;replace_me&#x27;, false
		FROM (SELECT 1) as data
		WHERE NOT EXISTS (SELECT * FROM pl_enmac_graphdb_loader.&quot;AppServerSettings&quot;);

		UPDATE pl_enmac_graphdb_loader.&quot;AppServerSettings&quot;
		SET &quot;appHost&quot; = &#x27;{appServer.ip}&#x27;,
			&quot;appOracleUsername&quot; = &#x27;pofinfo&#x27;,
			&quot;appOraclePassword&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;;
    END IF;
END
$$;



-- PoF SOAP
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_soap&#x27;
     )
    THEN
		UPDATE pl_enmac_soap.&quot;SettingProperty&quot;
		SET &quot;char_value&quot; = &#x27;http://{appServer.ip}:80/enmac/SOAP/&#x27;
		WHERE &quot;key&quot; = &#x27;agent.enmac.soap.url&#x27;;
    END IF;
END
$$;



-- PoF SQL
DO $$
BEGIN
    IF EXISTS(
        SELECT schema_name
          FROM information_schema.schemata
          WHERE schema_name = &#x27;pl_enmac_sql&#x27;
     )
    THEN
		UPDATE pl_enmac_sql.&quot;SettingProperty&quot;
		SET &quot;char_value&quot; = &#x27;{appServer.ip}&#x27;
		WHERE &quot;key&quot; = &#x27;agent.oracle.host&#x27;;

		UPDATE pl_enmac_sql.&quot;SettingProperty&quot;
		SET &quot;char_value&quot; = &#x27;pofinfo&#x27;
		WHERE &quot;key&quot; = &#x27;agent.oracle.user&#x27;;

		UPDATE pl_enmac_sql.&quot;SettingProperty&quot;
		SET &quot;char_value&quot; = &#x27;{oraclePofinfoAtNms.password}&#x27;
		WHERE &quot;key&quot; = &#x27;agent.oracle.pass&#x27;;
    END IF;
END
$$;




EOF
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrupdategistilespath">
                            <a href="#peekv3linpdrupdategistilespath">
                                <strong>Step 15 -</strong> Peek v3 LIN PDR Update GIS Tiles Path
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
psql &lt;&lt;EOF

-- GIS Diagram Loader
UPDATE pl_gis_diagram_loader.&quot;DxfImportSettingsTuple&quot;
SET &quot;dxfDirectory&quot; = &#x27;/home/peek/gis_tiles&#x27;;

EOF
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3purgerabbitmq">
                            <a href="#peekv3purgerabbitmq">
                                <strong>Step 16 -</strong> Peek v3 Purge RabbitMQ
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            <p>Requeues RabbitMQ </p>
                        </p>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {linuxrootuser}@{peekserver}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
redis-cli FLUSHDB &amp;&amp; \
rabbitmqctl stop_app &amp;&amp; \
rabbitmqctl reset &amp;&amp; \
rabbitmqctl start_app &amp;&amp; \
systemctl restart rabbitmq-server.service
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdredeleteoldlogs">
                            <a href="#peekv3linpdredeleteoldlogs">
                                <strong>Step 17 -</strong> Peek v3 LIN PDRE Delete Old Logs
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {linuxpeekuser}@{peekserver}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
rm -f *.log*
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h4 id="peekv3linpdrcleanrestoredir">
                            <a href="#peekv3linpdrcleanrestoredir">
                                <strong>Step 18 -</strong> Peek v3 LIN PDR Clean Restore Dir
                            </a>
                        </h4>
                    </div>

                    <div class="blueprint-description row">
                        <p>
                            
                        </p>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
cd /backup

if [ -d restore ]; then
    echo &quot;Cleaning restore directory&quot;
    rm -rf restore
else
    echo &quot;No cleaning required&quot;
fi
                </code>
            </pre>
        </div>
    </div>






                    <div class="row pt-5">
                        <div class="col">
                            <h3>Completed</h3>
                            <p>
                                You have completed this instruction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

<!-- Download Attune Ad -->

            <div class="col-lg-2 px-0">
                <div class="container px-0 pt-3 pl-5 sticky-top">
                    <div class="card border-light mb-3" style="max-width: 18rem;">
                        <div class="card-body attune-ad">
                            <img
                                src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                                alt="Attune - Powered by ServerTribe"
                                class="img-fluid">
                            <h5 class="card-title mt-3 text-center">
                                Automate with Attune
                            </h5>
                            <p class="card-text text-left">
                                Download the Attune Community Edition.
                            </p>
                            <p class="text-center">
                                <a href="https://www.servertribe.com/download-attune-registration/"
                                   class="btn btn-primary mt-3">
                                    DOWNLOAD!!!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- Join Discord -->

        <div class="row py-5">
            <div class="jumbotron">
                <h1 class="display-4 text-center">
                    Discuss this Instruction in Discord
                </h1>
                <p class="lead">

                    Join our Discord channel and connect with like-minded
                    individuals who
                    share your passion. Engage in lively discussions, gain
                    valuable insights,
                    and stay updated on the latest trends in our industry. Don't
                    miss out on
                    this opportunity to network, learn, and grow together.
                </p>
                <hr class="my-4 text-center">
                <div class="col px-0">
                    <p class="text-center">
                        Click the link below and become a part of our vibrant
                        community on
                        Discord today!
                    </p>
                    <p class="lead text-center">
                        <a class="btn btn-primary btn-lg"
                           href="https://discord.com/invite/3YpJsagqUn"
                           role="button">
                            Join NOW!!!
                        </a>
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


</body>
</html>
